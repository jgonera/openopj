OPJ (Origin Project files) format description
=============================================

This file contains a description of OPJ file format. It is incomplete
and contains only what was necessary for the author.

It is based on OPJ files generated by Origin 7 SR4 (7.0552) with [ITC200][]
addon (version 1.24.0.2, addon disk version 7.10).
Version of OPJ files: 4.2673, build: 552.

Some format information taken from [liborigin][], [liborigin2][]
and [SciDAVis][] [importOPJ][] filter in Python.

Author: Juliusz Gonera

[ITC200]: http://www.microcal.com/products/itc/itc200.asp
[liborigin]: http://sourceforge.net/projects/liborigin/
[liborigin2]: http://soft.proindependent.com/liborigin2/
[SciDAVis]: http://scidavis.sourceforge.net/
[importOPJ]: https://scidavis.svn.sourceforge.net/svnroot/scidavis/branches/origin_import/importOPJ


General observations
--------------------

* Files seem to be divided into blocks sperated by line feeds (0x0A).
* Integers are little endian.


### Size blocks

4-byte blocks seem to indicate the size of the following block (most likely
in case it contains 0x0A as its data in which case it could not be treated
as a regular block separator).

    0x0000, 4 bytes, int
      Size of the following block.

Sometimes there are 4-byte blocks filled with 0s. There is no zero-length
block following them. They seem to serve as a separator of file sections
and can appear in groups (often of 2 or 3, sometimes 5) if several nested
sections end.


File structure
--------------

OPJ files are divided in the following sections:

    Signature string
    Header
    Data list
        Data sections
    Window list
        Window sections
            Layer list
                Layer sections
                    Sublayers list
                    Curves list
                    AxisBreaks list
                    AxisParameters list
                    AxisParameters list
                    AxisParameters list
    Parameters section
    Note list
    Project tree
    Folder tree
    File list
    Folder list
    Attachment list
        Attachment sublist 1
        Attachment sublist 2

Sections are terminated with a 0 size block (`0A 00 00 00 00 0A`).


### Signature

A string containing three values separated by spaces (0x20) and terminated
with a line feed (0x0A).

    0x0000, 4 chars
        Magic identifier terminated with space, always "CPYA"?
    0x0005, 5 chars
        File version in MAJOR.MINOR format terminated with space
    0x000C, 4 chars (not constant?)
        Origin build number terminated with "#"

This is the only section that doesn't end with a 0 size block.


### Header

Since Origin 6.1 contains Origin version (importOPJ).

    0x0000, 27 bytes
        Unknown.
    0x001B, 8 bytes, double
        Origin version + build/10000 (e.g. 7.0552 is 7.0 build 552).
    0x0023, 4 bytes
        Unknown


### Data list

Data list contains multiple data sections one after another.


#### Data section

Data section consists of two blocks: header and content. It can contain
worksheet column values, matrix or graph data. liborigin calls each data
section a "column".


##### Data header block

Each data header block is prepended with a 0 size block and a following size
block. Size seems to be always 123.

The data header block itself has the following structure:

    0x0000, 22 bytes
        Unknown.
    0x0016, 2 bytes, short int
        [dataType] (liborigin).
    0x0018, 1 byte
        [dataType2] (importOPJ).
    0x0019, 4 bytes, int
        [totalRows] (importOPJ).
    0x001D, 4 bytes, int
        [firstRow] (importOPJ).
    0x0021, 4 bytes, int
        [lastRow] (importOPJ).
    0x0025, 24 bytes
        Unknown.
    0x003D, 1 byte
        [valueSize], size of a single data value.
    0x003E, 1 byte
        Unknown.
    0x003F, 1 byte
        [dataTypeU] (liborigin).
    0x0040, 24 bytes
        Unknown.
    0x0058, 25 bytes, zero-padded string
        Data name, for worksheets it's "WORKSHEET_COLUMN".
    0x0071, 10 bytes
        Unknown.

According to importOPJ the bytes starting at 0x0071 didn't exist before
Origin 5.0.


##### Data content block



### Parameters section

This section contains an arbitrary number of parameter elements. Each element
consists of:

    0x0000, n characters
        Parameter name.
    n, 1 byte
        Line feed.
    n+1, 8 bytes, double
        Parameter value.
    n+9, 1 byte
        Line feed.

The last parameter element is followed by a 0 byte and a line feed (`00 0A`),
i.e. if you encounter a parameter name equal to 0x0, there are no more
parameter elements.
